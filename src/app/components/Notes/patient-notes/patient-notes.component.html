<p-sidebar
  [(visible)]="sidebarVisible"
  position="right"
  [styleClass]="addingNote ? (isTemplateActive ? 'w-11/12' : 'w-1/2') : 'w-1/4'"
  (onHide)="resetSidebar()"
>
  <ng-template pTemplate="header">
    <div class="flex align-items-center gap-2">
      <span class="font-bold">Notes</span>
    </div>
  </ng-template>

  <div class="flex">
    <div
      class="pr-2 border-r border-gray-300"
      [ngClass]="{ 'w-1/2': addingNote == true, 'w-full': addingNote == false }"
    >
      <div class="flex justify-between items-center mb-2">
        <span class="font-bold">Notes</span>
        <a class="cursor-pointer" (click)="toggleAddNote()" *ngIf="!addingNote" [@inOutAnimation]="'open'"
          >+ Add Notes</a
        >
      </div>
      <div *ngFor="let note of notes">
        <div class="flex flex-row items-start gap-2 mb-4">
          <i class="pi pi-bookmark text-primary"></i>
          <div>
            <p class="font-bold m-0">{{ note.author }}</p>
            <p class="text-gray-500 m-0"><i class="pi pi-clock"></i> {{ note.date | date: "medium" }}</p>
            <p class="m-0">{{ note.text }}</p>
          </div>
        </div>
      </div>
    </div>

    <p-divider layout="vertical" class="h-[100vh]" *ngIf="addingNote" />
    <div class="w-1/2 pl-2" *ngIf="addingNote">
      <div class="flex justify-between items-center mb-2">
        <span class="font-bold">Add Notes</span>
        <a
          class="cursor-pointer mb-2 text-right"
          (click)="toggleAddNote()"
          *ngIf="addingNote"
          [@inOutAnimation]="'open'"
        >
          - Remove
        </a>
      </div>
      <textarea placeholder="Note" [(ngModel)]="newNote.text" rows="3" class="w-full p-2"></textarea>
      <p
        class="mt-2 text-right cursor-pointer"
        *ngIf="!isTemplateActive"
        (click)="toggleTemplate()"
        [@inOutAnimation]="'open'"
      >
        add from templates
      </p>
      <textarea placeholder="Template content" [(ngModel)]="templateContent" rows="3" class="w-full p-2"></textarea>
      <button pButton label="Submit" class="mt-4 w-full bg-[#6366f1] border-none" (click)="submitNote()"></button>
    </div>

    <p-divider layout="vertical" class="h-[100vh]" *ngIf="isTemplateActive" />
    <div class="w-3/4" *ngIf="isTemplateActive">
      <div class="flex justify-between items-center mb-2">
        <span class="font-bold">Add Notes From Templates</span>
        <a
          class="cursor-pointer mb-2 text-right"
          (click)="toggleTemplate()"
          *ngIf="isTemplateActive"
          [@inOutAnimation]="'open'"
          >- Remove Template</a
        >
      </div>
      <p-dropdown
        [options]="dropdownOptions"
        [(ngModel)]="selectedDropdownOption"
        placeholder="Select a template"
        optionLabel="label"
      ></p-dropdown>

      <!-- Conditionally show content based on dropdown selection -->
      <div *ngIf="selectedDropdownOption === 'actions'">
        <ul class="list-none">
          <li *ngFor="let action of actions">
            <p-checkbox [(ngModel)]="action.selected" binary="true" label="{{ action.label }}"></p-checkbox>
          </li>
        </ul>
      </div>

      <div *ngIf="selectedDropdownOption === 'customTemplate'">
        <textarea
          placeholder="Enter custom template"
          [(ngModel)]="customTemplateContent"
          rows="5"
          class="w-full p-2"
        ></textarea>
      </div>

      <div *ngIf="selectedDropdownOption === 'general'">
        <ul class="list-none">
          <li class="w-full flex flex-row justify-between" *ngFor="let note of generalNotes">
            <p>{{ note.text }}</p>
            <a class="text-primary" (click)="addToNote(note)">Add</a>
          </li>
        </ul>
      </div>

      <div *ngIf="selectedDropdownOption === 'bp'">
        <ul class="list-none">
          <li *ngFor="let category of bpCategories">
            <div (click)="toggleCategory(category)">
              <strong>{{ category.name }}</strong>
            </div>
            <ul *ngIf="category.expanded">
              <li *ngFor="let item of category.items">{{ item }}</li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
</p-sidebar>

<p-button
  (click)="sidebarVisible = true"
  icon="pi pi-book"
  class="notes-btn absolute bottom-4 right-4 border rounded-lg"
  label=""
></p-button>
